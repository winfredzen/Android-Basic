# 内存分配

参考：

+ [查看内存分配](https://developer.android.com/studio/command-line/dumpsys#ViewingAllocations)



## procstats

`procstats` 可以让您了解应用在一段时间内的表现，包括应用在后台运行的时长以及在该期间内的内存占用情况

其状态转储会显示有关每个应用的运行时间、按比例分摊的内存大小 (`PSS`)、独占内存大小 (`USS`) 和常驻内存大小 (`RSS`) 等统计信息

要获取过去三小时内应用的内存占用情况统计信息（采用简单易懂的格式）

```sh
adb shell dumpsys procstats --hours 3
```

输出会显示应用运行时间的百分比，以及 `PSS`、`USS` 和 `RSS`（`minPSS-avgPSS-maxPSS/minUSS-avgUSS-maxUSS/minRSS-avgRSS-maxRSS` over 样本数）



## meminfo

```shell
adb shell dumpsys meminfo package_name|pid [-d]
```

+ `-d` 标记会输出更多与 Dalvik 和 ART 内存占用情况相关的信息
+ 输出列出了应用当前的所有分配，以千字节为单位



运行命令输出的结果，形式如下：

![013](https://github.com/winfredzen/Android-Basic/blob/master/adb/images/013.png)



> **私有（干净和脏）RAM**
>
> 这是仅由您的进程使用的内存。这是您的应用进程销毁后系统可以回收的 RAM 容量。通常情况下，最重要的部分是私有脏 RAM，它的开销最大，**因为只有您的进程使用它**，而且其内容仅存在于 RAM 中，所以无法通过分页机制映射到硬盘（因为 Android 不使用交换）。您进行的所有 Dalvik 和原生堆分配都将是私有脏 RAM；您与 Zygote 进程共享的 Dalvik 和原生分配则是共享脏 RAM。



> **实际使用的物理内存（比例分配共享库占用的内存，PSS）**
>
> 这是对应用 RAM 占用情况的衡量，考虑了在进程之间共享 RAM 页的情况。您的进程独占的 RAM 页会直接计入其 PSS 值，而与其他进程共享的 RAM 页则仅会按相应比例计入 PSS 值。例如，两个进程之间共享的 RAM 页会将其一半的大小分别计入这两个进程的 PSS 中。































