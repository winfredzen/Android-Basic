# FTP

在Android上显示FTP的功能，在网络上搜索了下，可使用[Apache Commons Net](https://commons.apache.org/proper/commons-net/)库

在https://mvnrepository.com/中搜索Apache Commons Net，gradle依赖如下：

```groovy
// https://mvnrepository.com/artifact/commons-net/commons-net
implementation group: 'commons-net', name: 'commons-net', version: '3.8.0'
```



## FTP基础知识点

FTP（File Transfer Protocol）文件传输协议，在TCP/IP协议族中属于应用层协议运行于TCP协议之上是一种可靠的传输协议，主要功能用于实现用户间文件分发共享，以及网络管理者在进行设备版本升级、日志下载和配置保存等业务操作时，均会使用到FTP功能

FTP协议采用C/S结构

**FTP的两个TCP连接**

![030](https://github.com/winfredzen/Android-Basic/blob/master/%E7%BD%91%E7%BB%9C/images/030.png)

+ 控制连接（TCP 21端口）主要用于实现FTP协议**控制信令传送**，服务器端打开TCP 21端口被动等待客户端发起连接命令；客户端则以主动方式打开随机端口，发起连接的建立请求。

+ 数据连接（TCP 20端口）主要用于实现应用**数据传送**，服务器的数据连接端使用端口20。服务器执行主动打开数据连接，通常也执行主动关闭数据连接 。



**FTP连接建立方式：**

1.主动方式

主动方式也称为PORT方式，是FTP协议最初定义的数据传输连接方式，主要特点是:

FTP客户端通过向FTP服务器发送PORT命令，告诉服务器该客户端用于传输数据的临时端口号当需要传送数据时，服务器通过TCP端口号20与客户端的临时端口建立数据传输通道，完成数据传输。在建立数据连接的过程中，由服务器主动发起连接，因此被称为主动方式。

![031](https://github.com/winfredzen/Android-Basic/blob/master/%E7%BD%91%E7%BB%9C/images/031.jpeg)

2.被动方式

被动方式也称为PASV方式，被动方式的主要特点是:

FTP客户端通过向FTP服务器发送PASV命令，告诉服务器进入被动方式。服务器选择临时端口号并告知客户端当需要传送数据时，客户端主动与服务器的临时端口号建立数据传输通道，完成数据传输。在整个过程中，由于服务器总是被动接收客户端的数据连接，因此被称为被动方式。

![032](https://github.com/winfredzen/Android-Basic/blob/master/%E7%BD%91%E7%BB%9C/images/032.jpeg)



## Apache Commons Net

连接Server，IP + Port，如果有登录功能，还需要登录

```java
FTPClient client = new FTPClient();
client.connect(serverIp, port); //连接到FTP服务器
client.login(userName, passsword);
```

在进行登录后，还需要验证是否登录成功

```java
int reply = client.getReplyCode();
if (!FTPReply.isPositiveCompletion(reply)) {
    client.disconnect();
    Log.d(TAG, "无法连接到ftp服务器，错误码为：" + reply);
    return;
}
```

需要通过`FTPReply.isPositiveCompletion(reply)`用于验证是否成功连接到FTP服务器























































