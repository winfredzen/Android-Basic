# 圆角布局

实现一个布局，自动给它包裹的子控件添加圆角

```java
public class CustomRoundLayout extends LinearLayout {
    private Path mPath = new Path();
    private String mBgColor;

    public CustomRoundLayout(Context context) {
        super(context);
    }

    public CustomRoundLayout(Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
    }

    public CustomRoundLayout(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
    }

    @Override
    protected void onDraw(Canvas canvas) {
        /**
         * 修复背景问题
         * 1.控件的绘制顺序是先绘制背景，再绘制控件内容。
         * 2.绘制背景是在onDraw函数中执行，绘制子控件是在dispatchDraw中执行
         * 解决问题
         * 1.在onDraw函数中，先保存原来的背景色，并将背景色清空
         * 2.在dispatchDraw中绘制背景
         */
        if (TextUtils.isEmpty(mBgColor)) {
            Drawable bgDrawable = getBackground();
            if (bgDrawable instanceof  ColorDrawable) {
                ColorDrawable colorDrawable = (ColorDrawable) bgDrawable;
                int color = colorDrawable.getColor();
                mBgColor = "#" + String.format("%08x", color);
                Log.d("qijian", "color:" + color + "   " + mBgColor);
            }
        }

        setBackgroundColor(Color.parseColor("#00FFFFFF"));

        super.onDraw(canvas);
    }

    @Override
    protected void dispatchDraw(Canvas canvas) {
        mPath.reset();
        mPath.addRoundRect(new RectF(0, 0, getMeasuredWidth(), getMeasuredHeight()), 50, 50, Direction.CW);
        canvas.save();
        canvas.clipPath(mPath);

        if (!TextUtils.isEmpty(mBgColor)) {
            canvas.drawColor(Color.parseColor(mBgColor));
        }

        //在之前，先将Canvas裁剪成有圆角的
        super.dispatchDraw(canvas);
        canvas.restore();
    }
}
```

布局文件如下：

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingTop="5dp"
    android:background="#ffff00"
    android:layout_gravity="center"
    android:orientation="vertical"
    tools:context=".CustomRoundLayoutActivity">

    <com.custom.harvic.testcustomctrl.CustomRoundLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:background="@android:color/holo_green_dark"
        android:layout_gravity="center">

        <ImageView
            android:id="@+id/img"
            android:layout_width="200dp"
            android:layout_height="wrap_content"
            android:scaleType="centerCrop"
            android:src="@mipmap/dog"/>

        <TextView
            android:id="@+id/tv"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:padding="5dp"
            android:text="欢迎光临启舰的blog"/>
    </com.custom.harvic.testcustomctrl.CustomRoundLayout>

</LinearLayout>
```

效果如下：

![186](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/186.png)



