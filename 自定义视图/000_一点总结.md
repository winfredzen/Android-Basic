# 一点总结

**自定义View与DataBinding**

通常的自定义view，一般使用如下的方法来初始化view

```java
View view = LayoutInflater.from(context).inflate(R.layout.xxx_view, this, true);
```

自定义view中使用DataBinding，如何初始化view？可以使用如下的方式：

```java
 DataBindingUtil.inflate(LayoutInflater.from(context), R.layout.xxx_view, this, true);
```

自定义的RecyclerView Item，使用DataBinding，也是类似



**自定义View与LiveData、ViewModel**

通常在Activity、Fragment中是这样初始化ViewModel的，如：

```java
ChronometerViewModel chronometerViewModel
                = new ViewModelProvider(this).get(ChronometerViewModel.class);
```

但是在自定义View中，就不能这么用了，有看到直接使用new来初始化ViewModel的，但是一般不建议这样做

一种方式是参考：

+ [如何在自定义View里使用ViewModel](https://juejin.cn/post/7045162029077757988)

另一种方式是将Activity传递进自定义View中，如：

```java
    /**
     * 设置LifecycleOwner.
     *
     * @param activity activity
     */
    public void setLifecycleOwner(BaseActivity activity) {
        viewModel = new ViewModelProvider(activity).get(DetailViewModel.class);
        mBinding.setLifecycleOwner(activity);
        mBinding.setDetailModel(viewModel);
    }
```



## 坐标转换

参考：

+ [Getting View's coordinates relative to the root layout](https://stackoverflow.com/questions/3619693/getting-views-coordinates-relative-to-the-root-layout)



```java
Rect offsetViewBounds = new Rect();
//returns the visible bounds
childView.getDrawingRect(offsetViewBounds);
// calculates the relative coordinates to the parent
parentViewGroup.offsetDescendantRectToMyCoords(childView, offsetViewBounds); 

int relativeTop = offsetViewBounds.top;
int relativeLeft = offsetViewBounds.left;
```

