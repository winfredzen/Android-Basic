
# 事件分发深入一

本文内容来自《Android自定义控件高级进阶与精彩实例》

通过如下的布局，来研究Android事件分发机制

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.touch.harvic.testtouchevent.CustomFirstGroup
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:gravity="center"
    tools:context=".SecondActivity">

    <com.touch.harvic.testtouchevent.CustomSecondGroup
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:background="#00ff00"
        android:padding="50dp">

        <com.touch.harvic.testtouchevent.CustomTextView
            android:id="@+id/tv"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:padding="10dp"
            android:background="#ff0000"
            android:text="Text View"/>

    </com.touch.harvic.testtouchevent.CustomSecondGroup>

</com.touch.harvic.testtouchevent.CustomFirstGroup>
```

![094](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/094.png)

整个事件的传递，可以用如下的图来表示：

![095](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/095.png)

> `onInterceptTouchEvent`方法只有`ViewGroup`具有，`Activity`和`View`没有这个函数



## 不包含onInterceptTouchEvent方法的ACTION_DOWN消息传递

`dispatchTouchEvent`方法不同的返回值

+ `super.dispatchTouchEvent(event)`
+ `true`
+ `fase`

### 1.默认返回`super.dispatchTouchEvent(event)`

此时ACTION_DOWN消息的传递流程，就如上图所示：

![095](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/095.png)

此时的控制台的`log`输出如下，和上面也是相符的：

```java
2021-10-16 15:40:53.442 7598-7598/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.442 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.442 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.442 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomTextView dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.442 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomTextView onTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.443 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup onTouchEvent   EVENT: ACTION DOWN
2021-10-16 15:40:53.443 7598-7598/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup onTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.443 7598-7598/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:40:53.445 7598-7598/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
2021-10-16 15:40:53.445 7598-7598/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION_UP
```



### dispatchTouchEvent返回true

`dispatchTouchEvent`返回true，表示使用`dispatchTouchEvent`来拦截消息

在这里就有三种情况了

**1.Activity的`dispatchTouchEvent`函数函数中拦截消息**

此时控制台的输出如下，只有Activity的`dispatchTouchEvent`被调用了：

```java
2021-10-16 15:46:02.522 7744-7744/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 15:46:02.524 7744-7744/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
```

用图表示的话，如下：

![100](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/100.png)



**2.ViewGroup的`dispatchTouchEvent`函数函数中拦截消息**

如果在ViewGroup1的`dispatchTouchEvent`函数中返回true

此时控制台的输出如下，Activity和ViewGroup1的`dispatchTouchEvent`方法都被调用了

```java
2021-10-16 16:01:43.194 7942-7942/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:01:43.194 7942-7942/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
```

用图表示的话，如下：

![101](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/101.png)

如果在ViewGroup2的`dispatchTouchEvent`函数中返回true

```java
2021-10-16 16:30:54.109 8305-8305/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:30:54.109 8305-8305/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:30:54.109 8305-8305/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup dispatchTouchEvent  EVENT: ACTION DOWN
```

用图表示的话，如下：

![102](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/102.png)



**3.在View的`dispatchTouchEvent`函数中拦截消息**

在`TextView`中的`dispatchTouchEvent`函数中返回true

```java
2021-10-16 16:36:39.847 8467-8467/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:36:39.847 8467-8467/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:36:39.847 8467-8467/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-16 16:36:39.847 8467-8467/com.touch.harvic.testtouchevent D/qijian: CustomTextView dispatchTouchEvent  EVENT: ACTION DOWN
```

用图表示的话，如下：

![103](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/103.png)

**结论：无论哪个控件的dispatchTouchEvent函数中拦截消息，消息都会直接停止传递，后面的子控件都不会接收到这个消息**

### dispatchTouchEvent返回false

**1.TextView的dispatchTouchEvent返回false**

此时的`onTouchEvent`函数的返回值是`super.onTouchEvent`

```java
2021-10-17 18:38:43.531 10974-10974/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.531 10974-10974/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.531 10974-10974/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.532 10974-10974/com.touch.harvic.testtouchevent D/qijian: CustomTextView dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.532 10974-10974/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup onTouchEvent   EVENT: ACTION DOWN
2021-10-17 18:38:43.532 10974-10974/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup onTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.532 10974-10974/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:38:43.534 10974-10974/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
2021-10-17 18:38:43.534 10974-10974/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION_UP
```

![104](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/104.png)



**2.ViewGroup2的dispatchTouchEvent返回false**

```java
2021-10-17 18:44:32.821 11151-11151/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:44:32.821 11151-11151/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:44:32.822 11151-11151/com.touch.harvic.testtouchevent D/qijian: CustomSecondGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:44:32.822 11151-11151/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup onTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:44:32.822 11151-11151/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:44:32.825 11151-11151/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
2021-10-17 18:44:32.825 11151-11151/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION_UP
```

![105](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/105.png)



**3.ViewGroup1的dispatchTouchEvent返回false**

```java
2021-10-17 18:51:32.626 11340-11340/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:51:32.626 11340-11340/com.touch.harvic.testtouchevent D/qijian: CustomFirstGroup dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:51:32.626 11340-11340/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:51:32.630 11340-11340/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
2021-10-17 18:51:32.630 11340-11340/com.touch.harvic.testtouchevent D/qijian: SecondActivity onTouchEvent  EVENT: ACTION_UP
```

![106](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/106.png)



**4.Activity的dispatchTouchEvent返回false**

```java
2021-10-17 18:56:16.925 11605-11605/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION DOWN
2021-10-17 18:56:16.992 11605-11605/com.touch.harvic.testtouchevent D/qijian: SecondActivity dispatchTouchEvent  EVENT: ACTION_UP
```

![107](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/107.png)













































