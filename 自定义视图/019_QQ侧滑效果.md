# QQ侧滑效果

![161](https://github.com/winfredzen/Android-Basic/blob/master/自定义视图/images/161.gif)

主要代码`SlideMenuGroup`

```java
public class SlideMenuGroup extends FrameLayout {
    private static final String TAG = "SlideMenuGroup";
    private ViewDragHelper mViewDragHelper;
    //内容View
    private View mMainView;
    //菜单View
    private View mMenuView;

    //侧边栏宽度，限制mMainView被拖动的最大距离
    private int mMenuViewWidth = 500;

    public SlideMenuGroup(@NonNull Context context) {
        super(context);
        initView();
    }

    public SlideMenuGroup(@NonNull Context context, @Nullable AttributeSet attrs) {
        super(context, attrs);
        initView();
    }

    public SlideMenuGroup(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) {
        super(context, attrs, defStyleAttr);
        initView();
    }

    public void initView() {
        if (mViewDragHelper != null) {
            return;
        }
        mViewDragHelper = ViewDragHelper.create(this, new ViewDragHelper.Callback() {
            @Override
            public boolean tryCaptureView(@NonNull View child, int pointerId) {
                Log.d(TAG, "tryCaptureView");
                //只拖动mMainView
                return child == mMainView;
            }

            @Override
            public int clampViewPositionHorizontal(@NonNull View child, int left, int dx) {
                Log.d(TAG, "clampViewPositionHorizontal");
                //只有left>0时才移动，并且限制最大移动距离
                if (left > 0) {
                    return Math.min(left, mMenuViewWidth);
                }
                return 0;
            }

            @Override
            public void onViewPositionChanged(@NonNull View changedView, int left, int top, int dx, int dy) {
                super.onViewPositionChanged(changedView, left, top, dx, dy);
                //实现缩放动画
                float percent = mMainView.getLeft() / (float)mMenuViewWidth;
                executeAnimation(percent);

            }

            @Override
            public void onViewReleased(@NonNull View releasedChild, float xvel, float yvel) {
                //添加手指释放时的动画
                super.onViewReleased(releasedChild, xvel, yvel);
                if (mMainView.getLeft() < mMenuViewWidth / 2) {
                    //关闭侧边栏
                    mViewDragHelper.smoothSlideViewTo(mMainView, 0, 0);
                } else {
                    //打开侧边栏
                    mViewDragHelper.smoothSlideViewTo(mMainView, mMenuViewWidth, 0);
                }
                invalidate();
            }
        });
    }

    public void setView(View mainView, LayoutParams mainLayoutParams,
                        View menuView, LayoutParams menuLayoutParams) {
        mMenuView = menuView;
        addView(menuView, menuLayoutParams);
        mMenuViewWidth = menuLayoutParams.width;

        mMainView = mainView;
        addView(mainView, mainLayoutParams);
    }

    private void executeAnimation(float percent) {
        //MainView从1 - 0.8
        mMainView.setScaleX(1- percent * 0.2f);
        mMainView.setScaleY(1- percent * 0.2f);

        //侧边栏动画
        mMenuView.setScaleX(0.5f + 0.5f * percent);
        mMenuView.setScaleY(0.5f + 0.5f * percent);

        //位移动画
        mMenuView.setTranslationX(-mMenuViewWidth / 2 + mMenuViewWidth / 2 * percent);
    }

    //关闭侧边栏
    public void closeMenu() {
        mViewDragHelper.smoothSlideViewTo(mMainView, 0, 0);
        ViewCompat.postInvalidateOnAnimation(this);
    }


    @Override
    public void computeScroll() {
        super.computeScroll();
        if (mViewDragHelper != null && mViewDragHelper.continueSettling(true)) {
            invalidate();
        }
    }

    @Override
    public boolean onInterceptTouchEvent(MotionEvent ev) {
        return mViewDragHelper.shouldInterceptTouchEvent(ev);
    }

    @Override
    public boolean onTouchEvent(MotionEvent event) {
        mViewDragHelper.processTouchEvent(event);
        return true;
    }
}
```

添加MenuView和MainView

```java

    private SlideMenuGroup mSlideMenuGroup;
    private TextView mMainTextView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        mSlideMenuGroup = (SlideMenuGroup) findViewById(R.id.slide_menu_container);

        LayoutInflater inflater = LayoutInflater.from(this);
        /**
         * 1.attachToRoot为false，不将生成的View添加到所指定的父控件，单纯的返回View
         */
        View mainView = inflater.inflate(R.layout.slide_content_layout, null, false);
        mMainTextView = (TextView) mainView.findViewById(R.id.slide_main_view_text);
        FrameLayout.LayoutParams mainLayoutParams = new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT,
                FrameLayout.LayoutParams.MATCH_PARENT);

        //获取menuView
        int menuWidth = getResources().getDimensionPixelOffset(R.dimen.slide_menu_width);
        FrameLayout.LayoutParams menuLayoutParams = new FrameLayout.LayoutParams(menuWidth,
                FrameLayout.LayoutParams.WRAP_CONTENT);
        View menuView = inflater.inflate(R.layout.slide_menu_layout, null, false);
        //menu点击处理
        menuView.findViewById(R.id.menu_apple).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                changeMainViewText("苹果");
            }
        });
        menuView.findViewById(R.id.menu_banana).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                changeMainViewText("香蕉");
            }
        });
        menuView.findViewById(R.id.menu_pear).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                changeMainViewText("大鸭梨");
            }
        });

        mSlideMenuGroup.setView(mainView, mainLayoutParams, menuView, menuLayoutParams);

    }

    //修改文字，关闭menu
    private void changeMainViewText(String text) {
        mMainTextView.setText(text);
        mSlideMenuGroup.closeMenu();
    }
```

