# Zygote启动过程

init进程，解析`init.rc`文件，启动了zygote进程

`init.rc`文件import了Zygote启动脚本，如`system/core/rootdir/init.zygote32.rc`

```shell
service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server
    class main
    priority -20
    user root
    group root readproc reserved_disk
    socket zygote stream 660 root system
    socket usap_pool_primary stream 660 root system
    onrestart exec_background - system system -- /system/bin/vdc volume abort_fuse
    onrestart write /sys/power/state on
    # NOTE: If the wakelock name here is changed, then also
    # update it in SystemSuspend.cpp
    onrestart write /sys/power/wake_lock zygote_kwl
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart restart media
    onrestart restart media.tuner
    onrestart restart netd
    onrestart restart wificond
    task_profiles ProcessCapacityHigh
    critical window=${zygote.critical_window.minute:-off} target=zygote-fatal
```

可见，执行程序为`app_process`，classname为`main`



**Zygote进程启动过程**

![047](https://github.com/winfredzen/Android-Basic/blob/master/Framework/images/047.png)



**Zygote进程启动总结**

+ 创建`AppRuntime`并调用其`start`方法，启动Zygote进程

+ 创建Java虚拟机并为Java虚拟机注册JNI函数
+ 通过JNI调用`ZygoteInit`的`main`函数进入Zygote的Java框架层
+ 创建服务端`Socket`，并通过`runSelectLoop`方法等待AMS的请求来创建新的应用程序进程
+ 启动`SystemServer`进程





## 其它

可参考：

+ [Android系统启动流程（基于Android 11）](https://juejin.cn/post/6969141197596000263#heading-3)
+ [Android Zygote启动（AOSP 11）](https://juejin.cn/post/7006587391108448287)









