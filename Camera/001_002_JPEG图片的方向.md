# JPEG图片的方向

在上一节的Camera2 API的使用一文中，我自己实践后，发现图片的发现有点问题，所以记录下来自己验证的过程

在上面的教程中，拍照take photo，如果输出`.jpg`文件，教程中通过如下的方式设置方向：

```java
int rotation = getWindowManager().getDefaultDisplay().getRotation();
Log.e(TAG, "rotation = " + rotation + "ORIENTATIONS.get(rotation) = " + ORIENTATIONS.get(rotation));
captureStillBuilder.set(CaptureRequest.JPEG_ORIENTATION, ORIENTATIONS.get(rotation));
```

```kotlin
private static final SparseIntArray ORIENTATIONS = new SparseIntArray();
static {
    ORIENTATIONS.append(Surface.ROTATION_0, 90);
    ORIENTATIONS.append(Surface.ROTATION_90, 0);
    ORIENTATIONS.append(Surface.ROTATION_180, 270);
    ORIENTATIONS.append(Surface.ROTATION_270, 180);
}
```

然而，不同的手机，对这个方向的处理，貌似有不同

**Google Pixel**

手机正常的竖直方向，后置摄像头，拍摄一个正常的*笑脸*

1.如果不设置`CaptureRequest.JPEG_ORIENTATION`

但是在Android Studio中显示和Android的`ImageView`中显示，都是逆时针旋转90度，效果如下：

![013](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/013.png)

导出图像到Mac电脑，使用其它软件，查看exif元数据

![014](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/014.png)

> 没有图像方向信息

使用Mac上的*预览*来查看图片，同样是逆时针旋转90度

![015](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/015.png)

2.如果设置`CaptureRequest.JPEG_ORIENTATION`

```java
captureStillBuilder.set(CaptureRequest.JPEG_ORIENTATION, ORIENTATIONS.get(rotation));
```

Android Studio中显示和Android的`ImageView`中显示，都是正常的

![016](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/016.png)

查看exif元数据

![017](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/017.png)

> 没有图像方向信息

使用Mac上的*预览*来查看图片，方向是正常的

![018](https://github.com/winfredzen/Android-Basic/blob/master/Camera/images/018.png)











































