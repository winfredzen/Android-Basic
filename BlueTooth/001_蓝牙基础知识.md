# 蓝牙基础知识

蓝牙官网：

+ [Bluetooth 技术概述](https://www.bluetooth.com/zh-cn/learn-about-bluetooth/tech-overview/)



> **Bluetooth®经典**
>
> Bluetooth Classic无线电，也被称为Bluetooth 基本速率/增强数据速率（BR/EDR），是一种低功率无线电，在2.4GHz非授权工业、科学和医疗（ISM）频段的79个频道上进行数据流。支持点对点设备通信，Bluetooth Classic主要用于实现[无线音频流](https://www.bluetooth.com/zh-cn/learn-about-bluetooth/solutions/audio-streaming/)，已成为无线扬声器、耳机和车载娱乐系统背后的标准无线电协议。Bluetooth Classic无线电还能实现数据传输应用，包括移动打印。
>
> **Bluetooth®低能耗(LE)**
>
> Bluetooth 低能耗（LE）无线电是为非常低的功率操作而设计的。Bluetooth LE无线电在2.4GHz非授权ISM频段的40个信道上传输数据，为开发者提供了巨大的灵活性，以构建满足其市场独特连接要求的产品。Bluetooth LE支持多种通信拓扑结构，从点对点扩展到广播，最近又扩展到广播。 [mesh](https://www.bluetooth.com/zh-cn/learn-about-bluetooth/recent-enhancements/mesh/)，使Bluetooth 技术能够支持创建可靠的、大规模的[设备网络](https://www.bluetooth.com/zh-cn/learn-about-bluetooth/solutions/device-networks/)。虽然最初以其设备通信功能而闻名，但Bluetooth LE现在也被广泛用作设备定位技术，以满足对高精度室内定位服务日益增长的需求。Bluetooth LE现在包括一些功能，使一个设备能够确定另一个设备的存在、距离和[方向](https://www.bluetooth.com/zh-cn/learn-about-bluetooth/recent-enhancements/direction-finding/)。







## 蓝牙连接过程

> 参考：[蓝牙连接的过程](http://www.morlab.com/article/2013/0903/article_2506.html)
>
> 想要了解蓝牙的连接过程，必须先了解3个概念：
>
> 1，链路Link：物理链路，是基带协议中的概念，包括`ACL`链路和`SCO`链路两种，前者主要用于传递数据，后者传递语音。一对蓝牙设备，只存在一条ACL链路，允许存在3条SCO链路
>
> 2，信道channel: 这是L2DAP协议中的概念,是逻辑信道,信道的端点用信道标示符CID表示,用两个字节表示,所以最多存在65536个信道.即一条ACL链路可以存在最多65536个信道.信道包括信令信道和数据信道,通过信令信道建立数据信道,然后由数据信道传输数据.信令信道的CID为0x0001
>
> 3，连接connection：应用剖面上的概念，有了该剖面的connection,才能进行该剖面的服务和应用。
>
> 其中link establishment部分由LMP实现，channel establishment部分由L2CAP实现，connection establishment就是由具体的应用剖面（profile）来实现了。
>
> 我们以生活中常用的手机与蓝牙耳机之间的连接来详细分析蓝牙的连接过程：
>
> 首先，主设备（master,即发起连接的设备，这里指手机）会寻呼（page）从设备（slave,接收连接的设备，这里指蓝牙耳机），master会已跳频的方式去寻呼slave,slave会固定间隔地去扫描（scan）外部寻呼，即page scan，当scan 到外部page时便会响应response该page,这样两个设备之间便会建立link的连接，即ACL链路的连接。当ACL 链路连接建立后，主设备会发起channel的连接请求，即L2CAP的连接，建立L2CAP的连接之后，主设备采用SDP去查询从设备的免提服务，从中得到rfcomm的通道号，然后主设备会发起rfcomm的连接请求建立rfcomm的连接。然后就建立了应用的连接。
>
> 即link establish->channel establish->rfcomm establish->connection



**ACL vs SCO**

> 参考：[蓝牙技术中ACL和SCO 指的是?](https://www.poly.com/il/he/support/knowledge-base/kb-article-page?lang=zh_CN&urlName=RN16991&type=Product_Information__kav)
>
> 蓝牙基带技术支持两种连接方式:
>
> - **ACL** (Asynchronous Connectionless Link)     无连接的异步连接 （主要用于分组数据传输）
> - **SCO** (Synchronous Connection Oriented Link)  面向连接的同步连接 （主要用于话音传输）
>
> 蓝牙技术用来无线连接不同生产厂家生产的蓝牙设备，这些设备之间也需要相互的沟通，以便他们确认进行什么样类型的服务。蓝牙耳机是用于语音、听和说的音频设备，但当耳机不进行上述工作时，它还是要和其它的作为音频网关（ audio gateway ，简称 AG ）的设备，如手机， USB 适配器进行沟通。 一旦耳机完成了与 AG 的配对，它将进入一个待机模式。当耳机与 AG 在有效范围内时，它们以 ACL 方式连接。耳机与 AG 相互检测以确认范围，检测控制信号如来电，重拨或语音拨号需要等。 如果 AG 接收到一个电话且耳机的 ACL 是良好的， AG 将将信号知会给耳机，耳机将发出哔哔声提示用户有来电。按下耳机通话控制键，知会 AG 耳机可以开启 SCO 且语音数据可以在耳机和 AG 之间进行交换。



**BR/EDR vs BLE**

> 目前蓝牙最为普遍使用的有两种规格：
>
> - **蓝牙基础率/增强数据率 (Bluetooth Basic Rate/Enhanced Data Rate, BR/EDR)**: 也称为经典蓝牙。常用在对数据传输带宽有一定要求的场景上，比如需要传输音频数据的蓝牙音箱、蓝牙耳机等；
> - **蓝牙低功耗 (Bluetooth Low Energy, BLE)**: 从蓝牙 4.0 起支持的协议，特点就是功耗极低、传输速度更快，常用在对续航要求较高且只需小数据量传输的各种智能电子产品中，比如智能穿戴设备、智能家电、传感器等，应用场景广泛。





## BLE



### 协议

参考：

+ [深入浅出低功耗蓝牙(BLE)协议栈](https://www.cnblogs.com/iini/p/8969828.html)



![001](https://github.com/winfredzen/Android-Basic/blob/master/BlueTooth/image/001.png)



