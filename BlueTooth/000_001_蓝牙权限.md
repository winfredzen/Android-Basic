# 蓝牙权限

参考：

+ [蓝牙权限](https://developer.android.com/develop/connectivity/bluetooth/bt-permissions?hl=zh-cn#declare)



## 权限

上面的官方文档讲解的非常清晰，通常需要设置如下的权限：

```xml
<manifest>
    <!-- Request legacy Bluetooth permissions on older devices. -->
    <uses-permission android:name="android.permission.BLUETOOTH"
                     android:maxSdkVersion="30" />
    <uses-permission android:name="android.permission.BLUETOOTH_ADMIN"
                     android:maxSdkVersion="30" />

    <!-- Needed only if your app looks for Bluetooth devices.
         If your app doesn't use Bluetooth scan results to derive physical
         location information, you can
         <a href="#assert-never-for-location">strongly assert that your app
         doesn't derive physical location</a>. -->
    <uses-permission android:name="android.permission.BLUETOOTH_SCAN" />

    <!-- Needed only if your app makes the device discoverable to Bluetooth
         devices. -->
    <uses-permission android:name="android.permission.BLUETOOTH_ADVERTISE" />

    <!-- Needed only if your app communicates with already-paired Bluetooth
         devices. -->
    <uses-permission android:name="android.permission.BLUETOOTH_CONNECT" />

    <!-- Needed only if your app uses Bluetooth scan results to derive physical location. -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    ...
</manifest>
```

对于Android 11（API 级别 30）或更低版本，还需要设置如下的内容：

```xml
<uses-permission android:name="android.permission.BLUETOOTH_ADMIN" />

<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
```

`BLUETOOTH_ADMIN` - Allows applications to discover and pair bluetooth devices



> 如果您的应用支持某项服务并且可以在 Android 10（API 级别 29）或 Android 11 上运行，那么您还必须声明 [`ACCESS_BACKGROUND_LOCATION`](https://developer.android.com/reference/android/Manifest.permission?hl=zh-cn#ACCESS_BACKGROUND_LOCATION) 权限以发现蓝牙设备。如需详细了解此要求，请参阅[在后台访问位置信息](https://developer.android.com/training/location/background?hl=zh-cn)

```xml
<uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />
```



## 蓝牙功能

应用需要标准蓝牙功能

```xml
<uses-feature android:name="android.hardware.bluetooth" android:required="true"/>
```

应用依赖于低功耗蓝牙

```xml
<uses-feature android:name="android.hardware.bluetooth_le" android:required="true"/>
```

只有当应用在没有蓝牙功能的情况下无法正常运行时，才应将必需属性设置为 `true`



**检查蓝牙功能可用性**

通过`PackageManager.hasSystemFeature()`检查蓝牙功能可用性

```java
// Use this check to determine whether Bluetooth classic is supported on the device.
// Then you can selectively disable BLE-related features.
boolean bluetoothAvailable = getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH);

// Use this check to determine whether BLE is supported on the device. Then
// you can selectively disable BLE-related features.
boolean bluetoothLEAvailable = getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE);
```























