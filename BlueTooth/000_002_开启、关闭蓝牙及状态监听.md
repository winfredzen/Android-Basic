# 开启、关闭蓝牙及状态监听

以Android源码中的[BluetoothEnabler](https://cs.android.com/android/platform/superproject/+/main:packages/apps/Settings/src/com/android/settings/bluetooth/BluetoothEnabler.java)来说明

通过`BluetoothAdapter`来开启、关闭蓝牙：

```java
private final BluetoothAdapter mBluetoothAdapter;
......
mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
```

通过如下的方法，切换蓝牙的状态：

```java
    private boolean setBluetoothEnabled(boolean isEnabled) {
        return isEnabled ? mBluetoothAdapter.enable() : mBluetoothAdapter.disable();
    }
```



通过注册`BluetoothAdapter.ACTION_STATE_CHANGED`来监听蓝牙状态的变化

```java
private final IntentFilter mIntentFilter;

mIntentFilter = new IntentFilter(BluetoothAdapter.ACTION_STATE_CHANGED);

mContext.registerReceiver(mReceiver, mIntentFilter,
                Context.RECEIVER_EXPORTED_UNAUDITED);
```

```java
    private final BroadcastReceiver mReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            // Broadcast receiver is always running on the UI thread here,
            // so we don't need consider thread synchronization.
            int state = intent.getIntExtra(BluetoothAdapter.EXTRA_STATE, BluetoothAdapter.ERROR);
            handleStateChanged(state);
        }
    };
```

通过`handleStateChanged()`处理状态的变化：

```java
    void handleStateChanged(int state) {
        switch (state) {
            case BluetoothAdapter.STATE_TURNING_ON:
                mSwitchController.setEnabled(false);
                break;
            case BluetoothAdapter.STATE_ON:
                setChecked(true);
                mSwitchController.setEnabled(true);
                break;
            case BluetoothAdapter.STATE_TURNING_OFF:
                mSwitchController.setEnabled(false);
                break;
            case BluetoothAdapter.STATE_OFF:
                setChecked(false);
                mSwitchController.setEnabled(true);
                break;
            default:
                setChecked(false);
                mSwitchController.setEnabled(true);
        }
    }
```

可见其状态有：

+ `BluetoothAdapter.STATE_TURNING_ON`
+ `BluetoothAdapter.STATE_ON`
+ `BluetoothAdapter.STATE_TURNING_OFF`
+ `BluetoothAdapter.STATE_OFF`

















