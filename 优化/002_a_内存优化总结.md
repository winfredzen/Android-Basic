# 内存优化总结

内存不足，Android触发GC

GC采用的是垃圾标记算法，为根搜索算法。进行可达性分析

![021](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/021.png)

内存泄漏就是没有用的对象到GC Roots是可达的（被引用），导致GC无法回收该对象



## 内存泄漏的场景

1.非静态内部类会持有外部类实例的引用

2.匿名内部类持有外部类实例的引用

使用静态内部类解决

3.Handler内存泄漏

+ 静态Handler内部类+弱引用
+ 在`onDestroy`方法中移除`MessageQueue`中的消息



4.未正确使用Context，例如单例类持有某个Activity的context

使用Application Context来解决



5.静态的View

6.WebView

为WebView单开一个进程，使用AIDL与应用的主进程进行通信



7.资源对象未关闭，比如Cursor、File

8.集合中对象没有清理

9.Bitmap对象，Bitmap对象未回收

10.监听器未关闭，register后要unregister



## 工具

**1.Memory Profile**

a.大内存申请与GC

b.内存抖动 - 短时间内，发生了多次内存的分配与释放，严重的内存抖动还会导致应用卡顿

**2.MAT**

生成hprof文件



**3.LeakCanary**















