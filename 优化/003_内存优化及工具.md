# 内存优化及工具

**内存问题**

+ 内存抖动 - 锯齿状，GC频繁，导致卡段
+ 内存泄漏 - 可用内存减少，频繁GC
+ 内存溢出 - OOM，程序异常



**工具**

1.Memory Profiler

Android Studio自带的工具

![001](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/001.png)



2.Memory Analyzer

![002](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/002.png)

结合`Memory Profiler`一起使用



3.LeakCanary

自动内存泄漏检测



## 内存管理机制

**Java内存管理**

> 参考：
>
> + [Java内存管理机制](https://www.cnblogs.com/steffen/p/11368018.html)

> ![003](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/003.png)



**Android内存管理机制**

参考：

+ [内存管理概览](https://developer.android.com/topic/performance/memory-overview?hl=zh-cn)



## 内存泄漏

内存中存在没有用的对象



## Memory Analyzer

在[https://www.eclipse.org/mat/downloads.php](https://www.eclipse.org/mat/downloads.php)处下载MAT

然后在Memory Profiler中`Capture Heap Dump`

![004](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/004.png)

然后保存

![005](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/005.png)

文件的后缀为`.hprof`



**转换**

在sdk的路径下`/Users/wangzhen/Library/Android/sdk/platform-tools`的`hprof-conv`工具

生成转换文件：

```shell
hprof-conv /Users/wangzhen/Desktop/memory-20221028T151455.hprof /Users/wangzhen/Desktop/memory-20221028T151455_trans.hprof
```

使用MAT加载`memory-20221028T151455_trans.hprof`文件

![006](https://github.com/winfredzen/Android-Basic/blob/master/%E4%BC%98%E5%8C%96/images/006.png)

















